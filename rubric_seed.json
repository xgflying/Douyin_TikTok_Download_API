[
  {
    "rubric_id": "R01",
    "rubric_content": "在 bilibili_web.py 中新增 GET /down_video 接口且可被路由访问",
    "必要性": "Essential",
    "评估维度": "功能要求（functional requirement）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目明确要求新增 down_video 且方法类型为 GET；只需静态检查路由装饰器、路径与所属 router 即可二元判定。"
  },
  {
    "rubric_id": "R02",
    "rubric_content": "接口必须包含 bv_id 必填参数（作品 id）",
    "必要性": "Essential",
    "评估维度": "功能要求（functional requirement）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目明确要求 bv_id 必填；可通过检查函数签名/Query 定义是否缺省且无默认值来验证。"
  },
  {
    "rubric_id": "R03",
    "rubric_content": "接口必须支持 remove_watermark 可选参数且默认值为 0",
    "必要性": "Essential",
    "评估维度": "功能要求（functional requirement）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目明确给出 remove_watermark 的可选性与默认值；可通过检查 Query 默认值与参数声明验证。"
  },
  {
    "rubric_id": "R04",
    "rubric_content": "接口必须支持 resolution 可选参数且默认值为 0",
    "必要性": "Important",
    "评估维度": "功能要求（functional requirement）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目明确要求支持 resolution 且默认 0；可通过检查 Query 默认值与参数声明验证。"
  },
  {
    "rubric_id": "R05",
    "rubric_content": "下载的视频必须保存到项目根目录下的 video 目录",
    "必要性": "Essential",
    "评估维度": "功能要求（functional requirement）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目明确指定保存目录为项目根目录/video；可通过检查根目录定位与路径拼接实现来验证。"
  },
  {
    "rubric_id": "R06",
    "rubric_content": "下载的视频文件名必须为 {bv_id}.mp4",
    "必要性": "Essential",
    "评估维度": "功能要求（functional requirement）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目明确规定文件名格式；可通过检查输出文件路径的拼接规则（含 .mp4）进行验证。"
  },
  {
    "rubric_id": "R07",
    "rubric_content": "当 {bv_id}.mp4 已存在时必须直接返回该文件路径",
    "必要性": "Essential",
    "评估维度": "功能要求（functional requirement）",
    "验证方式": "动态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目明确要求存在即返回；可先放置同名文件再调用接口，验证不会重复下载且返回路径一致。"
  },
  {
    "rubric_id": "R08",
    "rubric_content": "下载成功时必须返回与同模块其他接口一致的 ResponseModel 结构",
    "必要性": "Important",
    "评估维度": "风格（style）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目要求参考页面其他接口返回；通过静态检查是否复用统一响应模型（如 code/router/data）即可验证。"
  },
  {
    "rubric_id": "R09",
    "rubric_content": "当 remove_watermark=1 时必须调用 ffmpeg 对输出视频做去水印处理",
    "必要性": "Essential",
    "评估维度": "功能要求（functional requirement）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目明确要求使用 ffmpeg 工具处理并去水印；可通过检查是否构造并执行 ffmpeg 命令验证。"
  },
  {
    "rubric_id": "R10",
    "rubric_content": "去水印策略必须明确针对右上角水印区域（包含 bilibili 字样）",
    "必要性": "Important",
    "评估维度": "功能要求（functional requirement）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目特别说明水印在右上角且包含 bilibili；通过静态检查是否对右上角区域做检测/裁剪/偏置/固定区域处理即可判定。"
  },
  {
    "rubric_id": "R11",
    "rubric_content": "关键处理链路（下载、保存、ffmpeg 去水印）必须包含注释说明",
    "必要性": "Optional",
    "评估维度": "风格（style）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目明确要求关键代码添加注释；静态检查相关函数/关键分支附近是否有解释性注释即可二元判定。"
  },
  {
    "rubric_id": "R12",
    "rubric_content": "当环境未安装 ffmpeg 时必须给出清晰可操作的错误提示",
    "必要性": "Pitfall",
    "评估维度": "鲁棒性（robustness）",
    "验证方式": "动态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目要求确保本地安装 ffmpeg；常见失败点是 ffmpeg 不在 PATH。可在无 ffmpeg 环境调用 remove_watermark=1 验证错误信息是否明确（如提示安装/路径）。"
  },
  {
    "rubric_id": "R13",
    "rubric_content": "下载失败时必须返回可定位问题的错误信息（包含异常 message）",
    "必要性": "Important",
    "评估维度": "鲁棒性（robustness）",
    "验证方式": "动态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Implicit",
    "rationale": "题目虽未限定错误模型，但可用性要求失败可诊断；通过传入无效 bv_id 或模拟网络失败，验证响应中包含可读错误 message。"
  },
  {
    "rubric_id": "R14",
    "rubric_content": "resolution=1/2 时必须尝试获取 720p/1080p（或更高）的视频流",
    "必要性": "Important",
    "评估维度": "功能要求（functional requirement）",
    "验证方式": "动态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Explicit",
    "rationale": "题目明确给出 resolution 枚举含义；通过分别调用 resolution=0/1/2 并检查实际输出视频高度/码流选择日志或返回字段可验证。"
  },
  {
    "rubric_id": "R15",
    "rubric_content": "视频下载必须采用分块/流式写入文件，避免一次性读入内存",
    "必要性": "Optional",
    "评估维度": "鲁棒性（robustness）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Implicit",
    "rationale": "大文件下载若一次性加载会造成内存风险；可静态检查是否使用 iter_bytes/stream/read chunk 循环写文件来验证。"
  },
  {
    "rubric_id": "R16",
    "rubric_content": "去水印输出必须先写入临时文件并在成功后原子替换最终文件",
    "必要性": "Optional",
    "评估维度": "鲁棒性（robustness）",
    "验证方式": "静态-模型验证",
    "显性(Explicit)隐性（Implicit）": "Implicit",
    "rationale": "ffmpeg 处理中断会导致目标文件损坏是常见隐性风险；静态检查是否使用 tmp 输出 + replace/rename 的方式可二元判定。"
  }
]
